---
export interface Props {
  variant?: "beaker" | "flask-round" | "flask-erlenmeyer" | "test-tube" | "solution";
  color?: string;
  class?: string;
}

const {
  variant = "beaker",
  color = "text-blue-500",
  class: className = "",
} = Astro.props;

// Random "liquid" level between 40% and 70%
const liquidLevel = Math.floor(Math.random() * 30) + 40;
---

<div class={`relative flex items-center justify-center ${className} group`}>
  <svg
    viewBox="0 0 100 120"
    class="w-full h-full drop-shadow-xl"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    {/* Common Glass Style */}
    <defs>
      <linearGradient id={`liquid-${variant}`} x1="0" y1="0" x2="0" y2="1">
        <stop
          offset="0%"
          stop-color="currentColor"
          class={`${color} opacity-40`}></stop>
        <stop
          offset="100%"
          stop-color="currentColor"
          class={`${color} opacity-70`}></stop>
      </linearGradient>

      <linearGradient id="rainbow-liquid" x1="0" y1="1" x2="1" y2="0">
         <stop offset="0%" stop-color="#3b82f6" />
         <stop offset="33%" stop-color="#8b5cf6" />
         <stop offset="66%" stop-color="#10b981" />
         <stop offset="100%" stop-color="#f59e0b" />
      </linearGradient>

      <filter id="glow">
        <feGaussianBlur stdDeviation="2" result="coloredBlur"></feGaussianBlur>
        <feMerge>
          <feMergeNode in="coloredBlur"></feMergeNode>
          <feMergeNode in="SourceGraphic"></feMergeNode>
        </feMerge>
      </filter>
    </defs>

    {
      variant === "beaker" && (
        <>
          {/* Liquid */}
          <path
            d={`M 20 ${100 - liquidLevel} L 80 ${100 - liquidLevel} L 80 95 Q 80 100 75 100 L 25 100 Q 20 100 20 95 Z`}
            fill={`url(#liquid-${variant})`}
            class="transition-all duration-1000 group-hover:opacity-90"
          />
          {/* Glass Outline */}
          <path
            d="M 15 10 L 15 95 Q 15 110 30 110 L 70 110 Q 85 110 85 95 L 85 15 L 90 10"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            class="opacity-50"
          />
          <path
            d="M 15 10 L 90 10"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            class="opacity-30"
          />

          {/* Measurement Lines */}
          <line
            x1="25"
            y1="80"
            x2="40"
            y2="80"
            stroke="white"
            stroke-width="1.5"
            class="opacity-30"
          />
          <line
            x1="25"
            y1="60"
            x2="45"
            y2="60"
            stroke="white"
            stroke-width="1.5"
            class="opacity-30"
          />
          <line
            x1="25"
            y1="40"
            x2="40"
            y2="40"
            stroke="white"
            stroke-width="1.5"
            class="opacity-30"
          />
        </>
      )
    }

    {
      variant === "flask-round" && (
        <>
          {/* Liquid */}
          <path
            d={`M 30 60 L 70 60 C 90 80 80 105 50 105 C 20 105 10 80 30 60 Z`}
            fill={`url(#liquid-${variant})`}
            class="transition-all duration-1000 group-hover:opacity-90"
          />

          {/* Glass Outline */}
          <path
            d="M 40 10 L 40 50 C 10 70 10 110 50 110 C 90 110 90 70 60 50 L 60 10"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            class="opacity-50"
          />
          <ellipse
            cx="50"
            cy="10"
            rx="10"
            ry="3"
            stroke="white"
            stroke-width="2"
            class="opacity-30"
          />
        </>
      )
    }

    {
      variant === "flask-erlenmeyer" && (
        <>
          {/* Liquid */}
          <path
            d={`M 35 ${100 - liquidLevel} L 65 ${100 - liquidLevel} L 85 100 L 15 100 Z`}
            fill={`url(#liquid-${variant})`}
            class="transition-all duration-1000 group-hover:opacity-90"
          />

          {/* Glass Outline */}
          <path
            d="M 40 10 L 40 40 L 10 100 Q 5 110 20 110 L 80 110 Q 95 110 90 100 L 60 40 L 60 10"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="opacity-50"
          />
          <ellipse
            cx="50"
            cy="10"
            rx="10"
            ry="3"
            stroke="white"
            stroke-width="2"
            class="opacity-30"
          />

          {/* Measurement Lines */}
          <line
            x1="45"
            y1="80"
            x2="55"
            y2="80"
            stroke="white"
            stroke-width="1.5"
            class="opacity-30"
          />
          <line
            x1="48"
            y1="60"
            x2="52"
            y2="60"
            stroke="white"
            stroke-width="1.5"
            class="opacity-30"
          />
        </>
      )
    }

    {
      variant === "solution" && (
        <>
          {/* Bubbles Animation */}
          <style>
              {`
              @keyframes bubble-rise {
                  0% { transform: translateY(0); opacity: 0; }
                  20% { opacity: 0.8; }
                  100% { transform: translateY(-40px); opacity: 0; }
              }
              .bubble { animation: bubble-rise 2s infinite ease-in; fill: white; opacity: 0.6; }
              .b1 { animation-delay: 0s; }
              .b2 { animation-delay: 0.5s; }
              .b3 { animation-delay: 1.2s; }
              `}
          </style>

          {/* Liquid */}
          <path 
              d={`M 25 50 L 75 50 C 95 70 85 100 50 100 C 15 100 5 70 25 50 Z`} 
              fill="url(#rainbow-liquid)"
              class="opacity-90"
              filter="url(#glow)"
          />
          
          {/* Bubbles */}
          <circle cx="45" cy="80" r="3" class="bubble b1" />
          <circle cx="55" cy="70" r="2" class="bubble b2" />
          <circle cx="50" cy="90" r="2.5" class="bubble b3" />


          {/* Glass Outline (Complex Round Bottom) */}
          <path
            d="M 35 10 L 35 40 C 5 60 5 105 50 105 C 95 105 95 60 65 40 L 65 10"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            class="opacity-60"
          />
          {/* Rim */}
          <ellipse cx="50" cy="10" rx="15" ry="4" stroke="white" stroke-width="2" class="opacity-40" />
          
          {/* Shine */}
          <path d="M 75 60 Q 80 70 80 85" stroke="white" stroke-width="3" stroke-linecap="round" class="opacity-30" />
        </>
      )
    }
  </svg>

  {/* Content Slot (Icon) positioned "inside" the liquid/glass */}
  <div
    class="absolute inset-x-0 bottom-4 flex justify-center items-center z-10 transform translate-y-[-20%] group-hover:scale-110 transition-transform duration-300"
  >
    <slot />
  </div>
</div>
