---
/* 
    This file is auto-generated by scripts/generate-background.js 
    Do not edit manually.
*/
const html = `<pre class="shiki synthwave-84" style="background-color:#262335;color:#bbbbbb" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// dominantField looks through the fields, all of which are known to</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// have the same name, to find the single field that dominates the</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// others using Go's embedding rules, modified by the presence of</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// JSON tags. If there are multiple top-level fields, the boolean</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// will be false: This condition is an error in Go and we skip all</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// the fields.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> dominantField</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">fields</span><span style="color:#FF7EDBFF"> []</span><span style="color:#FE4450">field</span><span style="color:#FF7EDBFF">) (</span><span style="color:#FE4450">field</span><span style="color:#FF7EDBFF">, </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// The fields are sorted in increasing index-length order. The winner</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// must therefore be one with the shortest index length. Drop all</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// longer entries, which is easy: just truncate the slice.</span></span>
<span class="line"><span style="color:#2EE2FA">	length</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">fields</span><span style="color:#FF7EDBFF">[</span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">].</span><span style="color:#2EE2FA">index</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">	tagged</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> -</span><span style="color:#F97E72">1</span><span style="color:#848BBD;font-style:italic"> // Index of first tagged field.</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> i</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">f</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> fields</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">f</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">index</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#2EE2FA"> length</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			fields</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> fields</span><span style="color:#FF7EDBFF">[:</span><span style="color:#2EE2FA">i</span><span style="color:#FF7EDBFF">]</span></span>
<span class="line"><span style="color:#FEDE5D">			break</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> f</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">tag</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#2EE2FA"> tagged</span><span style="color:#FEDE5D"> >=</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">				// Multiple tagged fields at the same level: conflict.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">				// Return no field.</span></span>
<span class="line"><span style="color:#FEDE5D">				return</span><span style="color:#FE4450"> field</span><span style="color:#FF7EDBFF">{}, </span><span style="color:#F97E72">false</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#2EE2FA">			tagged</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> i</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> tagged</span><span style="color:#FEDE5D"> >=</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fields</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">tagged</span><span style="color:#FF7EDBFF">], </span><span style="color:#F97E72">true</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// All remaining fields have the same length. If there's more than one,</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// we have a conflict (two fields named "X" at the same level) and we</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// return no field.</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">fields</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 1</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#FE4450"> field</span><span style="color:#FF7EDBFF">{}, </span><span style="color:#F97E72">false</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> fields</span><span style="color:#FF7EDBFF">[</span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">], </span><span style="color:#F97E72">true</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">var</span><span style="color:#2EE2FA"> fieldCache</span><span style="color:#72F1B8"> struct</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FE4450">	sync</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">RWMutex</span></span>
<span class="line"><span style="color:#2EE2FA">	m</span><span style="color:#FEDE5D"> map</span><span style="color:#FF7EDBFF">[</span><span style="color:#FE4450">reflect</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Type</span><span style="color:#FF7EDBFF">][]</span><span style="color:#FE4450">field</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// cachedTypeFields is like typeFields but uses a cache to avoid repeated work.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> cachedTypeFields</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">t</span><span style="color:#FE4450"> reflect</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Type</span><span style="color:#FF7EDBFF">) []</span><span style="color:#FE4450">field</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">	fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">RLock</span><span style="color:#FF7EDBFF">()</span></span>
<span class="line"><span style="color:#2EE2FA">	f</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">m</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">]</span></span>
<span class="line"><span style="color:#2EE2FA">	fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">RUnlock</span><span style="color:#FF7EDBFF">()</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> f</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> f</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// Compute fields without lock.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// Might duplicate effort but won't hold other computations back.</span></span>
<span class="line"><span style="color:#2EE2FA">	f</span><span style="color:#FFFFFFEE"> =</span><span style="color:#36F9F6"> typeFields</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> f</span><span style="color:#FEDE5D"> ==</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">		f</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FF7EDBFF"> []</span><span style="color:#FE4450">field</span><span style="color:#FF7EDBFF">{}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2EE2FA">	fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Lock</span><span style="color:#FF7EDBFF">()</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">m</span><span style="color:#FEDE5D"> ==</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">		fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">m</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FEDE5D"> map</span><span style="color:#FF7EDBFF">[</span><span style="color:#FE4450">reflect</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Type</span><span style="color:#FF7EDBFF">][]</span><span style="color:#FE4450">field</span><span style="color:#FF7EDBFF">{}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#2EE2FA">	fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">m</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">] </span><span style="color:#FFFFFFEE">=</span><span style="color:#2EE2FA"> f</span></span>
<span class="line"><span style="color:#2EE2FA">	fieldCache</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Unlock</span><span style="color:#FF7EDBFF">()</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> f</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> isValidTag</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#72F1B8"> string</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> s</span><span style="color:#FEDE5D"> ==</span><span style="color:#FF8B39"> ""</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> _</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">c</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		switch</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		case</span><span style="color:#2EE2FA"> strings</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">ContainsRune</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"!#$%&#x26;()*+-./:&#x3C;=>?@[]^_{|}~ "</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">c</span><span style="color:#FF7EDBFF">):</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">			// Backslash and quote chars are reserved, but</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">			// otherwise any punctuation chars are allowed</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">			// in a tag name.</span></span>
<span class="line"><span style="color:#FEDE5D">		default</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#FEDE5D"> !</span><span style="color:#2EE2FA">unicode</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">IsLetter</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">c</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">&#x26;&#x26;</span><span style="color:#FEDE5D"> !</span><span style="color:#2EE2FA">unicode</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">IsDigit</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">c</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#FEDE5D">				return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">const</span><span style="color:#FF7EDBFF"> (</span></span>
<span class="line"><span style="color:#2EE2FA">	caseMask</span><span style="color:#FFFFFFEE">     =</span><span style="color:#FEDE5D"> ^</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">(</span><span style="color:#F97E72">0x20</span><span style="color:#FF7EDBFF">) </span><span style="color:#848BBD;font-style:italic">// Mask to ignore case in ASCII.</span></span>
<span class="line"><span style="color:#2EE2FA">	kelvin</span><span style="color:#FFFFFFEE">       =</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">\u212a</span><span style="color:#FF8B39">'</span></span>
<span class="line"><span style="color:#2EE2FA">	smallLongEss</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">\u017f</span><span style="color:#FF8B39">'</span></span>
<span class="line"><span style="color:#FF7EDBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// foldFunc returns one of four different case folding equivalence</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// functions, from most general (and slow) to fastest:</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// 1) bytes.EqualFold, if the key s contains any non-ASCII UTF-8</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// 2) equalFoldRight, if s contains special folding ASCII ('k', 'K', 's', 'S')</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// 3) asciiEqualFold, no special, but includes non-letters (including _)</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// 4) simpleLetterEqualFold, no specials, no non-letters.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// The letters S and K are special because they map to 3 runes, not just 2:</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//   - S maps to s and to U+017F 'ſ' Latin small letter long s</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//   - k maps to K and to U+212A 'K' Kelvin sign</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// See http://play.golang.org/p/tTxjOc0OGo</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">//</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// The returned function is specialized for matching against s and</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// should only be given s. It's not curried for performance reasons.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> foldFunc</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#FF7EDBFF"> []</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">t</span><span style="color:#FF7EDBFF"> []</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">	nonLetter</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#2EE2FA">	special</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#F97E72"> false</span><span style="color:#848BBD;font-style:italic"> // special letter</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> _</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">b</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> b</span><span style="color:#FEDE5D"> >=</span><span style="color:#2EE2FA"> utf8</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">RuneSelf</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#2EE2FA"> bytes</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">EqualFold</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#2EE2FA">		upper</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> b</span><span style="color:#FEDE5D"> &#x26;</span><span style="color:#2EE2FA"> caseMask</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> upper</span><span style="color:#FEDE5D"> &#x3C;</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">A</span><span style="color:#FF8B39">'</span><span style="color:#FEDE5D"> ||</span><span style="color:#2EE2FA"> upper</span><span style="color:#FEDE5D"> ></span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">Z</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			nonLetter</span><span style="color:#FFFFFFEE"> =</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">		} </span><span style="color:#FEDE5D">else</span><span style="color:#FEDE5D"> if</span><span style="color:#2EE2FA"> upper</span><span style="color:#FEDE5D"> ==</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">K</span><span style="color:#FF8B39">'</span><span style="color:#FEDE5D"> ||</span><span style="color:#2EE2FA"> upper</span><span style="color:#FEDE5D"> ==</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">S</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">			// See above for why these letters are special.</span></span>
<span class="line"><span style="color:#2EE2FA">			special</span><span style="color:#FFFFFFEE"> =</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> special</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> equalFoldRight</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> nonLetter</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> asciiEqualFold</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> simpleLetterEqualFold</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// equalFoldRight is a specialization of bytes.EqualFold when s is</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// known to be all ASCII (including punctuation), but contains an 's',</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// 'S', 'k', or 'K', requiring a Unicode fold on the bytes in t.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// See comments on foldFunc.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> equalFoldRight</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">t</span><span style="color:#FF7EDBFF"> []</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> _</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">sb</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">==</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#2EE2FA">		tb</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> t</span><span style="color:#FF7EDBFF">[</span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">]</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> tb</span><span style="color:#FEDE5D"> &#x3C;</span><span style="color:#2EE2FA"> utf8</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">RuneSelf</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> tb</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">				sbUpper</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> &#x26;</span><span style="color:#2EE2FA"> caseMask</span></span>
<span class="line"><span style="color:#FEDE5D">				if</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">A</span><span style="color:#FF8B39">'</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#2EE2FA"> sbUpper</span><span style="color:#FEDE5D"> &#x26;&#x26;</span><span style="color:#2EE2FA"> sbUpper</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">Z</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">					if</span><span style="color:#2EE2FA"> sbUpper</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> tb</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">caseMask</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">						return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">					}</span></span>
<span class="line"><span style="color:#FF7EDBFF">				} </span><span style="color:#FEDE5D">else</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">					return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">				}</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#2EE2FA">			t</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> t</span><span style="color:#FF7EDBFF">[</span><span style="color:#F97E72">1</span><span style="color:#FF7EDBFF">:]</span></span>
<span class="line"><span style="color:#FEDE5D">			continue</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">		// sb is ASCII and t is not. t must be either kelvin</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">		// sign or long s; sb must be s, S, k, or K.</span></span>
<span class="line"><span style="color:#2EE2FA">		tr</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">size</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> utf8</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">DecodeRune</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">		switch</span><span style="color:#2EE2FA"> sb</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		case</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">s</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">'</span><span style="color:#F97E72">S</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#2EE2FA"> tr</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> smallLongEss</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">				return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#FEDE5D">		case</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">k</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">'</span><span style="color:#F97E72">K</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#2EE2FA"> tr</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> kelvin</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">				return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#FEDE5D">		default</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#2EE2FA">		t</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> t</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">size</span><span style="color:#FF7EDBFF">:]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">&#x3C;=</span><span style="color:#F97E72"> 0</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// asciiEqualFold is a specialization of bytes.EqualFold for use when</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// s is all ASCII (but may contain non-letters) and contains no</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// special-folding letters.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// See comments on foldFunc.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> asciiEqualFold</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">t</span><span style="color:#FF7EDBFF"> []</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">s</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">!=</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> i</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">sb</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">		tb</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> t</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">i</span><span style="color:#FF7EDBFF">]</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> ==</span><span style="color:#2EE2FA"> tb</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			continue</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF8B39">'</span><span style="color:#F97E72">a</span><span style="color:#FF8B39">'</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> &#x26;&#x26;</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">z</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">||</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF8B39">'</span><span style="color:#F97E72">A</span><span style="color:#FF8B39">'</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> &#x26;&#x26;</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D"> &#x3C;=</span><span style="color:#FF8B39"> '</span><span style="color:#F97E72">Z</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#FEDE5D">			if</span><span style="color:#2EE2FA"> sb</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">caseMask</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> tb</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">caseMask</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">				return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">			}</span></span>
<span class="line"><span style="color:#FF7EDBFF">		} </span><span style="color:#FEDE5D">else</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// simpleLetterEqualFold is a specialization of bytes.EqualFold for</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// use when s is all ASCII letters (no underscores, etc) and also</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// doesn't contain 'k', 'K', 's', or 'S'.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// See comments on foldFunc.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> simpleLetterEqualFold</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">s</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">t</span><span style="color:#FF7EDBFF"> []</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">s</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">!=</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">t</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> i</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">b</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> range</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> b</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">caseMask</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> t</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">i</span><span style="color:#FF7EDBFF">]</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">caseMask</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// tagOptions is the string following a comma in a struct field's "json"</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// tag, or the empty string. It does not include the leading comma.</span></span>
<span class="line"><span style="color:#FEDE5D">type</span><span style="color:#FE4450"> tagOptions</span><span style="color:#72F1B8"> string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// parseTag splits a struct field's json tag into its name and</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// comma-separated options.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#36F9F6"> parseTag</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">tag</span><span style="color:#72F1B8"> string</span><span style="color:#FF7EDBFF">) (</span><span style="color:#72F1B8">string</span><span style="color:#FF7EDBFF">, </span><span style="color:#FE4450">tagOptions</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> idx</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> strings</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Index</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">tag</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">","</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">idx</span><span style="color:#FEDE5D"> !=</span><span style="color:#FEDE5D"> -</span><span style="color:#F97E72">1</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> tag</span><span style="color:#FF7EDBFF">[:</span><span style="color:#2EE2FA">idx</span><span style="color:#FF7EDBFF">], </span><span style="color:#36F9F6">tagOptions</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">tag</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">idx</span><span style="color:#FEDE5D">+</span><span style="color:#F97E72">1</span><span style="color:#FF7EDBFF">:])</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> tag</span><span style="color:#FF7EDBFF">, </span><span style="color:#36F9F6">tagOptions</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">""</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// Contains reports whether a comma-separated list of options</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// contains a particular substr flag. substr must be surrounded by a</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// string boundary or commas.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">o </span><span style="color:#FE4450">tagOptions</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">Contains</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">optionName</span><span style="color:#72F1B8"> string</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">bool</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">o</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">==</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#2EE2FA">	s</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#72F1B8"> string</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">o</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#2EE2FA"> s</span><span style="color:#FEDE5D"> !=</span><span style="color:#FF8B39"> ""</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		var</span><span style="color:#2EE2FA"> next</span><span style="color:#72F1B8"> string</span></span>
<span class="line"><span style="color:#2EE2FA">		i</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> strings</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Index</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">s</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">","</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> i</span><span style="color:#FEDE5D"> >=</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			s</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">next</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> s</span><span style="color:#FF7EDBFF">[:</span><span style="color:#2EE2FA">i</span><span style="color:#FF7EDBFF">], </span><span style="color:#2EE2FA">s</span><span style="color:#FF7EDBFF">[</span><span style="color:#2EE2FA">i</span><span style="color:#FEDE5D">+</span><span style="color:#F97E72">1</span><span style="color:#FF7EDBFF">:]</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> s</span><span style="color:#FEDE5D"> ==</span><span style="color:#2EE2FA"> optionName</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#F97E72"> true</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#2EE2FA">		s</span><span style="color:#FFFFFFEE"> =</span><span style="color:#2EE2FA"> next</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> false</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">package</span><span style="color:#FE4450"> kyaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">import</span><span style="color:#FF7EDBFF"> (</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">bytes</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">encoding/json</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">errors</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">fmt</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">io</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">regexp</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">strconv</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">strings</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">time</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">unicode</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF8B39">	"</span><span style="color:#FE4450">unicode/utf8</span><span style="color:#FF8B39">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2EE2FA">	yaml</span><span style="color:#FF8B39"> "</span><span style="color:#FE4450">go.yaml.in/yaml/v3</span><span style="color:#FF8B39">"</span></span>
<span class="line"><span style="color:#FF7EDBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// Encoder formats objects or YAML data (JSON is valid YAML) into KYAML. KYAML</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// is halfway between YAML and JSON, but is a strict subset of YAML, so it</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// should should be readable by any YAML parser. It is designed to be explicit</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// and unambiguous, and eschews significant whitespace.</span></span>
<span class="line"><span style="color:#FEDE5D">type</span><span style="color:#FE4450"> Encoder</span><span style="color:#72F1B8"> struct</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// Compact tells the encoder to use compact formatting. This puts all the</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// data on one line, with no extra newlines, no comments, and no multi-line</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// formatting.</span></span>
<span class="line"><span style="color:#2EE2FA">	Compact</span><span style="color:#72F1B8"> bool</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// FromYAML renders a KYAML (multi-)document from YAML bytes (JSON is YAML),</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// including the KYAML header. The result always has a trailing newline.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">FromYAML</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">in</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Reader</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// We need a YAML decoder to handle multi-document streams.</span></span>
<span class="line"><span style="color:#2EE2FA">	dec</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">NewDecoder</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">in</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// Process each document in the stream.</span></span>
<span class="line"><span style="color:#FEDE5D">	for</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		var</span><span style="color:#2EE2FA"> doc</span><span style="color:#FE4450"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Node</span></span>
<span class="line"><span style="color:#2EE2FA">		err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> dec</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Decode</span><span style="color:#FF7EDBFF">(</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> err</span><span style="color:#FEDE5D"> ==</span><span style="color:#2EE2FA"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">EOF</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			break</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error decoding: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">DocumentNode</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: expected a document node, got </span><span style="color:#2EE2FA">%s</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">nodeKindString</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FF7EDBFF">))</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">		// Always emit a document separator, which helps disambiguate between YAML</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">		// and JSON.</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> _</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprintln</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"---"</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#2EE2FA"> err</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#2EE2FA"> err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderDocument</span><span style="color:#FF7EDBFF">(</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">, </span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">flags</span><span style="color:#FF7EDBFF">(), </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">			return</span><span style="color:#2EE2FA"> err</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#2EE2FA">		fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprintf</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// FromObject renders a KYAML document from a Go object, including the KYAML</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// header. The result always has a trailing newline.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">FromObject</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">obj</span><span style="color:#FE4450"> any</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">	jb</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> json</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Marshal</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">obj</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error marshaling to JSON: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// JSON is YAML.</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">FromYAML</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">bytes</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">NewReader</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">jb</span><span style="color:#FF7EDBFF">), </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// Marshal renders a single Go object as KYAML, without the header or trailing</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// newline.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">Marshal</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">obj</span><span style="color:#FE4450"> any</span><span style="color:#FF7EDBFF">) ([]</span><span style="color:#72F1B8">byte</span><span style="color:#FF7EDBFF">, </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF">) {</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// Convert the object to JSON bytes to take advantage of all the JSON tag</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// handling and things like that.</span></span>
<span class="line"><span style="color:#2EE2FA">	jb</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> json</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Marshal</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">obj</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error marshaling to JSON: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2EE2FA">	buf</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#FEDE5D"> &#x26;</span><span style="color:#FE4450">bytes</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Buffer</span><span style="color:#FF7EDBFF">{}</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// JSON is YAML.</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">fromObjectYAML</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">bytes</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">NewReader</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">jb</span><span style="color:#FF7EDBFF">), </span><span style="color:#2EE2FA">buf</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error rendering object: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> buf</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Bytes</span><span style="color:#FF7EDBFF">(), </span><span style="color:#F97E72">nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">fromObjectYAML</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">in</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Reader</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">	yb</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">ReadAll</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">in</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> err</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	var</span><span style="color:#2EE2FA"> doc</span><span style="color:#FE4450"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Node</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Unmarshal</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">yb</span><span style="color:#FF7EDBFF">, </span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error decoding: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FEDE5D"> !=</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">DocumentNode</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: expected document node, got </span><span style="color:#2EE2FA">%s</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">nodeKindString</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FF7EDBFF">))</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderNode</span><span style="color:#FF7EDBFF">(</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">, </span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">flags</span><span style="color:#FF7EDBFF">(), </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"error rendering document: </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">err</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// From the YAML spec.</span></span>
<span class="line"><span style="color:#FEDE5D">const</span><span style="color:#FF7EDBFF"> (</span></span>
<span class="line"><span style="color:#2EE2FA">	intTag</span><span style="color:#FFFFFFEE">       =</span><span style="color:#FF8B39"> "!!int"</span></span>
<span class="line"><span style="color:#2EE2FA">	floatTag</span><span style="color:#FFFFFFEE">     =</span><span style="color:#FF8B39"> "!!float"</span></span>
<span class="line"><span style="color:#2EE2FA">	boolTag</span><span style="color:#FFFFFFEE">      =</span><span style="color:#FF8B39"> "!!bool"</span></span>
<span class="line"><span style="color:#2EE2FA">	strTag</span><span style="color:#FFFFFFEE">       =</span><span style="color:#FF8B39"> "!!str"</span></span>
<span class="line"><span style="color:#2EE2FA">	timestampTag</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FF8B39"> "!!timestamp"</span></span>
<span class="line"><span style="color:#2EE2FA">	seqTag</span><span style="color:#FFFFFFEE">       =</span><span style="color:#FF8B39"> "!!seq"</span></span>
<span class="line"><span style="color:#2EE2FA">	mapTag</span><span style="color:#FFFFFFEE">       =</span><span style="color:#FF8B39"> "!!map"</span></span>
<span class="line"><span style="color:#2EE2FA">	nullTag</span><span style="color:#FFFFFFEE">      =</span><span style="color:#FF8B39"> "!!null"</span></span>
<span class="line"><span style="color:#2EE2FA">	binaryTag</span><span style="color:#FFFFFFEE">    =</span><span style="color:#FF8B39"> "!!binary"</span></span>
<span class="line"><span style="color:#2EE2FA">	mergeTag</span><span style="color:#FFFFFFEE">     =</span><span style="color:#FF8B39"> "!!merge"</span></span>
<span class="line"><span style="color:#FF7EDBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">type</span><span style="color:#FE4450"> flagMask</span><span style="color:#72F1B8"> uint64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">const</span><span style="color:#FF7EDBFF"> (</span></span>
<span class="line"><span style="color:#2EE2FA">	flagsNone</span><span style="color:#FE4450">     flagMask</span><span style="color:#FFFFFFEE"> =</span><span style="color:#F97E72"> 0</span></span>
<span class="line"><span style="color:#2EE2FA">	flagLazyQuote</span><span style="color:#FE4450"> flagMask</span><span style="color:#FFFFFFEE"> =</span><span style="color:#F97E72"> 0x01</span></span>
<span class="line"><span style="color:#2EE2FA">	flagCompact</span><span style="color:#FE4450">   flagMask</span><span style="color:#FFFFFFEE"> =</span><span style="color:#F97E72"> 0x02</span></span>
<span class="line"><span style="color:#FF7EDBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// flags returns a flagMask representing the current encoding options. It can</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// be used directly or OR'ed with another mask.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">flags</span><span style="color:#FF7EDBFF">() </span><span style="color:#FE4450">flagMask</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">	flags</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> flagsNone</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Compact</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">		flags</span><span style="color:#FFFFFFEE"> |=</span><span style="color:#2EE2FA"> flagCompact</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> flags</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// renderNode processes a YAML node, calling the appropriate render function</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// for its type.  Each render function should assume that the output "cursor"</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// is positioned at the start of the node and should not emit a final newline.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// If a render function needs to linewrap or indent (e.g. a struct), it should</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// assume the indent level is currently correct for the node type itself, and</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// may need to indent more.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">renderNode</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">node</span><span style="color:#FEDE5D"> *</span><span style="color:#FE4450">yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Node</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">indent</span><span style="color:#72F1B8"> int</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">flags</span><span style="color:#FE4450"> flagMask</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> node</span><span style="color:#FEDE5D"> ==</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#F97E72"> nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">	switch</span><span style="color:#2EE2FA"> node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">DocumentNode</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderDocument</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">ScalarNode</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderScalar</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">SequenceNode</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderSequence</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">MappingNode</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderMapping</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">AliasNode</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderAlias</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: unknown node kind </span><span style="color:#2EE2FA">%v</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Kind</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// renderDocument processes a YAML document node, rendering it to the output.</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// This function assumes that the output "cursor" is positioned at the start of</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// the document. This does not emit a final newline.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">renderDocument</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">doc</span><span style="color:#FEDE5D"> *</span><span style="color:#FE4450">yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Node</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">indent</span><span style="color:#72F1B8"> int</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">flags</span><span style="color:#FE4450"> flagMask</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Content</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">==</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: document has no content node (</span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">)"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#36F9F6">len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Content</span><span style="color:#FF7EDBFF">))</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Content</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 1</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: document has more than one content node (</span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">)"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#36F9F6">len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Content</span><span style="color:#FF7EDBFF">))</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> indent</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: document non-zero indent (</span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">)"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2EE2FA">	compact</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> flags</span><span style="color:#FEDE5D">&#x26;</span><span style="color:#2EE2FA">flagCompact</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">	// For document nodes, the cursor is assumed to be ready to render.</span></span>
<span class="line"><span style="color:#2EE2FA">	child</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Content</span><span style="color:#FF7EDBFF">[</span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">]</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#FEDE5D"> !</span><span style="color:#2EE2FA">compact</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">HeadComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">HeadComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">			fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">HeadComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">HeadComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">			fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#2EE2FA"> err</span><span style="color:#FFFFFFEE"> :=</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderNode</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">); </span><span style="color:#2EE2FA">err</span><span style="color:#FEDE5D"> !=</span><span style="color:#F97E72"> nil</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> err</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	if</span><span style="color:#FEDE5D"> !</span><span style="color:#2EE2FA">compact</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">LineComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">" "</span><span style="color:#FEDE5D">+</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">LineComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">FootComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">child</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">FootComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">LineComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">" "</span><span style="color:#FEDE5D">+</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">LineComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#F97E72">0</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FEDE5D">		if</span><span style="color:#36F9F6"> len</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">FootComment</span><span style="color:#FF7EDBFF">) </span><span style="color:#FEDE5D">></span><span style="color:#F97E72"> 0</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#2EE2FA">			fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\n</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#2EE2FA">			ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderComments</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">doc</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">FootComment</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">		}</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// renderScalar processes a YAML scalar node, rendering it to the output.  This</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// DOES NOT render a trailing newline or head/line/foot comments, as those</span></span>
<span class="line"><span style="color:#848BBD;font-style:italic">// require the parent context.</span></span>
<span class="line"><span style="color:#FEDE5D">func</span><span style="color:#FF7EDBFF"> (</span><span style="color:#FF7EDB;font-style:italic">ky </span><span style="color:#FEDE5D">*</span><span style="color:#FE4450">Encoder</span><span style="color:#FF7EDBFF">) </span><span style="color:#36F9F6">renderScalar</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF7EDB;font-style:italic">node</span><span style="color:#FEDE5D"> *</span><span style="color:#FE4450">yaml</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Node</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">indent</span><span style="color:#72F1B8"> int</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">flags</span><span style="color:#FE4450"> flagMask</span><span style="color:#FF7EDBFF">, </span><span style="color:#FF7EDB;font-style:italic">out</span><span style="color:#FE4450"> io</span><span style="color:#FF7EDBFF">.</span><span style="color:#FE4450">Writer</span><span style="color:#FF7EDBFF">) </span><span style="color:#72F1B8">error</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	switch</span><span style="color:#2EE2FA"> node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Tag</span><span style="color:#FF7EDBFF"> {</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> intTag</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">floatTag</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">boolTag</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">nullTag</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#2EE2FA">		fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Fprint</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Value</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	case</span><span style="color:#2EE2FA"> strTag</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">timestampTag</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> ky</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">renderString</span><span style="color:#FF7EDBFF">(</span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Value</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">indent</span><span style="color:#FEDE5D">+</span><span style="color:#F97E72">1</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">flags</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">out</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FEDE5D">	default</span><span style="color:#FF7EDBFF">:</span></span>
<span class="line"><span style="color:#FEDE5D">		return</span><span style="color:#2EE2FA"> fmt</span><span style="color:#FF7EDBFF">.</span><span style="color:#36F9F6">Errorf</span><span style="color:#FF7EDBFF">(</span><span style="color:#FF8B39">"kyaml internal error: line </span><span style="color:#2EE2FA">%d</span><span style="color:#FF8B39">: unknown tag </span><span style="color:#2EE2FA">%q</span><span style="color:#FF8B39"> on scalar node </span><span style="color:#2EE2FA">%q</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Line</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Tag</span><span style="color:#FF7EDBFF">, </span><span style="color:#2EE2FA">node</span><span style="color:#FF7EDBFF">.</span><span style="color:#2EE2FA">Value</span><span style="color:#FF7EDBFF">)</span></span>
<span class="line"><span style="color:#FF7EDBFF">	}</span></span>
<span class="line"><span style="color:#FEDE5D">	return</span><span style="color:#F97E72"> nil</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">const</span><span style="color:#2EE2FA"> kyamlFoldStr</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FF8B39"> "</span><span style="color:#36F9F6">\\\n</span><span style="color:#FF8B39">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FEDE5D">var</span><span style="color:#2EE2FA"> regularEscapeMap</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FEDE5D"> map</span><span style="color:#FF7EDBFF">[</span><span style="color:#72F1B8">rune</span><span style="color:#FF7EDBFF">]</span><span style="color:#72F1B8">string</span><span style="color:#FF7EDBFF">{</span></span>
<span class="line"><span style="color:#FF8B39">	'</span><span style="color:#F97E72">\n</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">: </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\\</span><span style="color:#FF8B39">n"</span><span style="color:#FEDE5D"> +</span><span style="color:#2EE2FA"> kyamlFoldStr</span><span style="color:#FF7EDBFF">, </span><span style="color:#848BBD;font-style:italic">// use YAML's line folding to make the output more readable</span></span>
<span class="line"><span style="color:#FF8B39">	'</span><span style="color:#F97E72">\t</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">: </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\t</span><span style="color:#FF8B39">"</span><span style="color:#FF7EDBFF">,                 </span><span style="color:#848BBD;font-style:italic">// literal tab</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"><span style="color:#FEDE5D">var</span><span style="color:#2EE2FA"> compactEscapeMap</span><span style="color:#FFFFFFEE"> =</span><span style="color:#FEDE5D"> map</span><span style="color:#FF7EDBFF">[</span><span style="color:#72F1B8">rune</span><span style="color:#FF7EDBFF">]</span><span style="color:#72F1B8">string</span><span style="color:#FF7EDBFF">{</span></span>
<span class="line"><span style="color:#FF8B39">	'</span><span style="color:#F97E72">\n</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">: </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\\</span><span style="color:#FF8B39">n"</span><span style="color:#FF7EDBFF">,</span></span>
<span class="line"><span style="color:#FF8B39">	'</span><span style="color:#F97E72">\t</span><span style="color:#FF8B39">'</span><span style="color:#FF7EDBFF">: </span><span style="color:#FF8B39">"</span><span style="color:#36F9F6">\\</span><span style="color:#FF8B39">t"</span><span style="color:#FF7EDBFF">,</span></span>
<span class="line"><span style="color:#FF7EDBFF">}</span></span>
<span class="line"></span></code></pre>`;
---
<div
    class="absolute inset-0 opacity-30 whitespace-pre font-mono text-xs leading-tight mix-blend-screen"
    set:html={html}
/>
