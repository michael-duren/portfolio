---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import avatar from "../images/avatar_temp.png";
import ThemeToggle from "./ThemeToggle.astro";
const { animated } = Astro.props;
---

<header class="navbar justify-between">
  <div
    class="flex-1 sm:grow-0 sm:shrink-0 flex flex-col md:flex-row items-center gap-0 md:gap-2 sm:gap-1"
  >
    <div>
      {
        !animated ? (
          <h1 class=" text-3xl sm:text-4xl md:text-5xl font-rock  drop-shadow-md">
            Michael Duren
          </h1>
        ) : (
          <h1
            id="title"
            class=" text-3xl sm:text-4xl md:text-5xl font-rock  drop-shadow-md"
          />
        )
      }
    </div>
    <div class="flex gap-1 sm:gap-2">
      <ThemeToggle />
      <button
        id="sound-toggle"
        class="btn btn-circle btn-ghost btn-sm sm:btn-md"
        aria-label="Toggle sound"
        title="Toggle sound"
      >
        <Icon id="sound-icon-on" name="iconoir:sound-low" class="h-6 w-6" />
        <Icon
          id="sound-icon-off"
          name="iconoir:sound-off"
          class="h-6 w-6 hidden"
        />
      </button>
    </div>
  </div>

  <div
    class="avatar shadow-lg shadow-blue-500 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2"
  >
    <div class="w-24 md:w-28 lg:w-32 rounded-full">
      <Image
        class="rounded-full"
        src={avatar}
        alt="A avatar of Michael Duren"
        transition:persist
      />
    </div>
  </div>
</header>

<script>
  import { sound } from "../store/store";

  const updateSoundIcon = (isOn: boolean) => {
    const iconOn = document.querySelector("#sound-icon-on");
    const iconOff = document.querySelector("#sound-icon-off");
    if (iconOn && iconOff) {
      if (isOn) {
        iconOn.classList.remove("hidden");
        iconOff.classList.add("hidden");
      } else {
        iconOn.classList.add("hidden");
        iconOff.classList.remove("hidden");
      }
    }
  };

  let isSetup = false;

  const setupSoundToggle = () => {
    const soundToggle = document.querySelector("#sound-toggle");
    if (!soundToggle) return;

    updateSoundIcon(sound.get());

    if (!isSetup) {
      sound.listen((value) => {
        updateSoundIcon(value);
      });

      soundToggle.addEventListener("click", () => {
        sound.set(!sound.get());
      });

      isSetup = true;
    }
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupSoundToggle);
  } else {
    setupSoundToggle();
  }

  document.addEventListener("astro:page-load", setupSoundToggle);
</script>
