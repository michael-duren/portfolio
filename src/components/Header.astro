---
import { Image } from "astro:assets";
import { Icon } from "astro-icon";
import avatar from "../images/avatar_temp.jpeg";
import ThemeToggle from "./ThemeToggle.astro";
const { animated } = Astro.props;
---

<header class="flex mx-auto min-w-[10vw] mb-auto h-full flex-col">
  <div
    class="w-full flex mb-4 sm:mb-8 md:mb-16 items-center justify-center gap-4 sm:gap-0 sm:justify-between"
  >
    <div class="avatar flex-1">
      <div
        class="w-24 shadow-lg shadow-blue-500 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2"
      >
        <Image
          class="rounded-full h-36 w-36"
          src={avatar}
          alt="A avatar of Michael Duren"
          transition:persist
        />
      </div>
    </div>
    <div class="flex-1 sm:flex-grow-0 sm:flex-shrink-0 flex items-center gap-2 sm:gap-4">
      <div>
        {
          !animated ? (
            <h1 class=" text-3xl sm:text-4xl md:text-5xl font-rock  drop-shadow-md">
              Michael Duren
            </h1>
          ) : (
            <h1
              id="title"
              class=" text-3xl sm:text-4xl md:text-5xl font-rock  drop-shadow-md"
            />
          )
        }
      </div>
      <div class="flex gap-1 sm:gap-2">
        <ThemeToggle />
        <button
          id="sound-toggle"
          class="btn btn-circle btn-ghost btn-sm sm:btn-md"
          aria-label="Toggle sound"
          title="Toggle sound"
        >
          <Icon id="sound-icon-on" name="iconoir:sound-low" class="h-6 w-6" />
          <Icon
            id="sound-icon-off"
            name="iconoir:sound-off"
            class="h-6 w-6 hidden"
          />
        </button>
      </div>
    </div>
  </div>
</header>

<script>
  import { sound } from "../store/store";

  const updateSoundIcon = (isOn: boolean) => {
    const iconOn = document.querySelector("#sound-icon-on");
    const iconOff = document.querySelector("#sound-icon-off");
    if (iconOn && iconOff) {
      if (isOn) {
        iconOn.classList.remove("hidden");
        iconOff.classList.add("hidden");
      } else {
        iconOn.classList.add("hidden");
        iconOff.classList.remove("hidden");
      }
    }
  };

  let isSetup = false;

  const setupSoundToggle = () => {
    const soundToggle = document.querySelector("#sound-toggle");
    if (!soundToggle) return;

    // Set initial icon state
    updateSoundIcon(sound.get());

    // Only set up listeners once to avoid duplicates
    if (!isSetup) {
      // Listen to sound changes
      sound.listen((value) => {
        updateSoundIcon(value);
      });

      // Toggle sound on click
      soundToggle.addEventListener("click", () => {
        sound.set(!sound.get());
      });

      isSetup = true;
    }
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupSoundToggle);
  } else {
    setupSoundToggle();
  }

  document.addEventListener("astro:page-load", setupSoundToggle);
</script>
