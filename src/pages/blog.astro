---
import MainLayout from "../layouts/MainLayout.astro";
import { getCollection } from "astro:content";
import AnimatedBackground from "../components/AnimatedBackground.astro";

const allBlogPosts = await getCollection("blog", ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = allBlogPosts.sort(
  (a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime()
);

function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}
---

<MainLayout title="Michael Duren - Blog">
  <AnimatedBackground />
  <div class="w-full max-w-5xl mx-auto">
    <div
      class="bg-gray-900 dark:bg-gray-950 rounded-lg shadow-2xl overflow-hidden border-2 border-gray-700 dark:border-gray-600"
    >
      <!-- Terminal Header -->
      <div
        class="bg-gray-800 dark:bg-gray-900 px-4 py-2 flex items-center gap-2 border-b border-gray-700 dark:border-gray-600"
      >
        <div class="flex gap-2">
          <span class="w-3 h-3 rounded-full bg-red-500"></span>
          <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
          <span class="w-3 h-3 rounded-full bg-green-500"></span>
        </div>
        <span class="text-gray-400 dark:text-gray-500 text-sm ml-4 font-mono"
          >~/portfolio/blog</span
        >
      </div>

      <!-- Terminal Content -->
      <div class="p-6 font-mono text-sm overflow-y-auto max-h-[80vh]">
        <!-- Command prompt -->
        <div class="flex items-center gap-2 mb-4">
          <span class="text-green-400 dark:text-green-300">michael@portfolio</span>
          <span class="text-gray-400 dark:text-gray-500">:</span>
          <span class="text-blue-400 dark:text-blue-300">~/blog</span>
          <span class="text-gray-400 dark:text-gray-500">$</span>
          <span class="text-gray-300 dark:text-gray-400">ls -la posts</span>
        </div>

        <!-- Blog posts list -->
        {
          sortedPosts.length === 0 ? (
            <div class="text-gray-400 dark:text-gray-500 mb-4">
              <p>No blog posts found.</p>
            </div>
          ) : (
            sortedPosts.map((post, index) => (
              <div
                class="mb-6 animate-fade-in"
                style={`animation-delay: ${index * 0.1}s`}
              >
                <div class="flex items-start gap-4">
                  <span class="text-blue-400 dark:text-blue-300 font-bold">
                    [{index + 1}]
                  </span>
                  <div class="flex-1">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
                      <a
                        href={`/blog/${post.slug}`}
                        class="text-yellow-400 dark:text-yellow-300 text-lg font-bold hover:text-yellow-300 dark:hover:text-yellow-200 transition-colors"
                      >
                        {post.data.title}
                      </a>
                      <span class="text-gray-500 dark:text-gray-600 text-xs">
                        {formatDate(post.data.publishDate)}
                      </span>
                    </div>

                    <p class="text-gray-300 dark:text-gray-400 leading-relaxed mb-2">
                      {post.data.description}
                    </p>

                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2 mb-2">
                        <span class="text-gray-500 dark:text-gray-600 text-xs">
                          tags:
                        </span>
                        {post.data.tags.map((tag) => (
                          <span class="text-cyan-400 dark:text-cyan-300 text-xs">
                            #{tag}
                          </span>
                        ))}
                      </div>
                    )}

                    <a
                      href={`/blog/${post.slug}`}
                      class="text-green-400 dark:text-green-300 hover:text-green-300 dark:hover:text-green-200 transition-colors text-xs inline-flex items-center gap-1"
                    >
                      <span class="opacity-70">[</span>read more
                      <span class="opacity-70">]</span>
                    </a>

                    <div class="border-t border-gray-800 dark:border-gray-700 mt-4" />
                  </div>
                </div>
              </div>
            ))
          )
        }

        <!-- Bottom prompt -->
        <div class="flex items-center gap-2 mt-6">
          <span class="text-green-400 dark:text-green-300">michael@portfolio</span>
          <span class="text-gray-400 dark:text-gray-500">:</span>
          <span class="text-blue-400 dark:text-blue-300">~/blog</span>
          <span class="text-gray-400 dark:text-gray-500">$</span>
          <span class="text-gray-300 dark:text-gray-400 blinking-cursor">_</span>
        </div>
      </div>
    </div>
  </div>
</MainLayout>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    opacity: 0;
    animation: fade-in 0.5s ease-out forwards;
  }

  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }

  .blinking-cursor {
    animation: blink 1s infinite;
  }

  /* Scrollbar styling for dark theme */
  .overflow-y-auto::-webkit-scrollbar {
    width: 8px;
  }

  .overflow-y-auto::-webkit-scrollbar-track {
    background: #1f2937;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 4px;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
  }
</style>
