---
import { getCollection, type CollectionEntry } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<"blog">;
};

const { post } = Astro.props;
const { Content } = await post.render();
---

<MainLayout title={`${post.data.title} | Michael Duren`}>
  <article class="relative z-10 max-w-3xl mx-auto px-4 py-20">
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-gray-400 hover:text-purple-400 mb-8 transition-colors"
    >
      <Icon name="mdi:arrow-left" class="w-5 h-5" />
      Back to Blog
    </a>

    <div
      class="p-8 rounded-3xl bg-black/40 backdrop-blur-xl border border-white/10 shadow-xl"
    >
      <header class="mb-10">
        <h1 class="text-3xl md:text-5xl font-bold mb-4 text-white">
          {post.data.title}
        </h1>
        <div class="flex flex-wrap items-center gap-4 text-gray-400">
          <div class="flex items-center gap-2">
            <Icon name="mdi:calendar" class="w-5 h-5" />
            <time datetime={post.data.pubDate.toISOString()}>
              {
                post.data.pubDate.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })
              }
            </time>
          </div>
          <div class="w-1 h-1 rounded-full bg-gray-400"></div>
          <div class="flex items-center gap-2">
            <Icon name="mdi:account" class="w-5 h-5" />
            <span>{post.data.author}</span>
          </div>
        </div>
        {
          post.data.heroImage && (
            <div class="mt-8 mb-8 rounded-2xl overflow-hidden shadow-2xl border border-white/10 aspect-video">
              <Image
                src={post.data.heroImage}
                alt={post.data.title}
                width={1200}
                height={675}
                class="w-full h-full object-cover"
                loading="eager"
              />
            </div>
          )
        }
        {
          post.data.tags && (
            <div class="flex flex-wrap gap-2 mt-6">
              {post.data.tags.map((tag: string) => (
                <span class="px-3 py-1 text-sm rounded-full bg-purple-900/30 text-purple-300 border border-purple-700/50">
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <div
        class="prose prose-lg prose-invert max-w-none
                prose-headings:text-white
                prose-a:text-purple-400 hover:prose-a:text-purple-300
                prose-pre:bg-[#1e1e1e] prose-pre:border prose-pre:border-white/10 prose-pre:rounded-xl prose-pre:shadow-xl
                prose-code:text-purple-400 prose-code:bg-purple-900/20 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
                prose-img:rounded-xl prose-img:shadow-lg
                prose-blockquote:border-l-4 prose-blockquote:border-purple-500 prose-blockquote:bg-purple-900/10 prose-blockquote:py-1 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-blockquote:not-italic"
      >
        <Content />
      </div>
    </div>
  </article>
</MainLayout>
