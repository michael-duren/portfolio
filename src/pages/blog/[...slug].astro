---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blog");
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { Content } = await post.render();

function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<!doctype html>
<html lang="en" class="transition-colors duration-300">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />

    <script is:inline>
      (function () {
        function getSystemTheme() {
          if (typeof window !== "undefined" && window.matchMedia) {
            return window.matchMedia("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
          }
          return "light";
        }

        function applyThemeClass(resolvedTheme) {
          if (resolvedTheme === "dark") {
            document.documentElement.classList.add("dark");
          } else {
            document.documentElement.classList.remove("dark");
          }
          document.documentElement.setAttribute("data-theme", resolvedTheme);
        }

        let storedTheme;
        try {
          const stored = localStorage.getItem("theme");
          storedTheme = stored ? JSON.parse(stored) : "system";
        } catch (e) {
          storedTheme = "system";
        }

        const resolvedTheme =
          storedTheme === "system" ? getSystemTheme() : storedTheme;

        applyThemeClass(resolvedTheme);
      })();
    </script>

    <meta name="description" content={post.data.description} />
    <meta property="og:type" content="article" />
    <meta property="og:title" content={post.data.title} />
    <meta property="og:description" content={post.data.description} />
    <title>{post.data.title} - Michael Duren</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rock+Salt&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"
  >
    <div class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
      <!-- Back to blog link -->
      <nav class="mb-8">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
              clip-rule="evenodd"></path>
          </svg>
          Back to Blog
        </a>
      </nav>

      <!-- Article -->
      <article class="prose prose-lg dark:prose-invert max-w-none">
        <header class="mb-8 pb-8 border-b border-gray-200 dark:border-gray-700">
          <h1
            class="text-4xl md:text-5xl font-bold mb-4 text-gray-900 dark:text-gray-100"
          >
            {post.data.title}
          </h1>
          <div
            class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400"
          >
            <time datetime={post.data.publishDate.toISOString()}>
              {formatDate(post.data.publishDate)}
            </time>
            {
              post.data.updatedDate && (
                <span>(Updated: {formatDate(post.data.updatedDate)})</span>
              )
            }
          </div>
          {
            post.data.tags && post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-4">
                {post.data.tags.map((tag) => (
                  <span class="px-3 py-1 text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
            )
          }
        </header>

        <div class="blog-content">
          <Content />
        </div>
      </article>

      <!-- Footer navigation -->
      <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
              clip-rule="evenodd"></path>
          </svg>
          Back to Blog
        </a>
      </footer>
    </div>

    <script>
      import { initTheme, applyTheme, getTheme } from "../../scripts/theme";

      document.addEventListener("astro:page-load", () => {
        initTheme();
      });

      document.addEventListener("astro:after-swap", () => {
        applyTheme(getTheme());
      });
    </script>
  </body>
</html>

<style is:global>
  @import "../../styles/global.styles.css" /* Blog content typography */
    .blog-content {
    font-size: 1.125rem;
    line-height: 1.75;
    color: #374151;
  }

  .dark .blog-content {
    color: #d1d5db;
  }

  .blog-content h2 {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: #111827;
  }

  .dark .blog-content h2 {
    color: #f9fafb;
  }

  .blog-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: #1f2937;
  }

  .dark .blog-content h3 {
    color: #f3f4f6;
  }

  .blog-content p {
    margin-bottom: 1.5rem;
  }

  .blog-content a {
    color: #7c3aed;
    text-decoration: underline;
    text-decoration-color: rgba(124, 58, 237, 0.3);
    text-underline-offset: 2px;
    transition: all 0.2s;
  }

  .dark .blog-content a {
    color: #a78bfa;
    text-decoration-color: rgba(167, 139, 250, 0.3);
  }

  .blog-content a:hover {
    color: #6d28d9;
    text-decoration-color: rgba(109, 40, 217, 0.6);
  }

  .dark .blog-content a:hover {
    color: #c4b5fd;
    text-decoration-color: rgba(196, 181, 253, 0.6);
  }

  .blog-content ul,
  .blog-content ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .blog-content li {
    margin-bottom: 0.5rem;
  }

  .blog-content code {
    background-color: #f3f4f6;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    font-family: "Courier New", Courier, monospace;
    color: #7c3aed;
  }

  .dark .blog-content code {
    background-color: #374151;
    color: #a78bfa;
  }

  .blog-content pre {
    background-color: #1f2937;
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1.5rem;
    border: 1px solid #374151;
  }

  .dark .blog-content pre {
    background-color: #111827;
    border-color: #1f2937;
  }

  .blog-content pre code {
    background-color: transparent;
    padding: 0;
    color: #e5e7eb;
    font-size: 0.9rem;
  }

  .dark .blog-content pre code {
    color: #f3f4f6;
  }

  .blog-content blockquote {
    border-left: 4px solid #7c3aed;
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: #6b7280;
  }

  .dark .blog-content blockquote {
    border-left-color: #a78bfa;
    color: #9ca3af;
  }

  .blog-content strong {
    font-weight: 600;
    color: #111827;
  }

  .dark .blog-content strong {
    color: #f9fafb;
  }

  .blog-content em {
    font-style: italic;
  }

  .blog-content hr {
    margin: 2rem 0;
    border: 0;
    border-top: 1px solid #e5e7eb;
  }

  .dark .blog-content hr {
    border-top-color: #374151;
  }

  /* Ensure good reading experience - no distracting animations */
  .blog-content * {
    animation: none !important;
  }
</style>
